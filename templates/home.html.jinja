{% extends "base.html.jinja" %}
{% block title %}Início{% endblock %}
{% block content %}
<h2>Campeonatos</h2>
<div class="item-list">
    {% for campeonato in campeonatos %}
    <button class="campeonato-item" id="{{ campeonato.id_campeonato }}">
        <table>
            <tr>
                <td>
                    <img class="campeonato-logo" src="{{ campeonato.url_logo }}"/>
                </td>
                <td>
                    <p style="margin: 4px;"><b>{{ campeonato.nome }}</b></p>
                    <p style="margin: 4px; font-size: 10pt;">{{ campeonato.andamento }}</p>
                </td>
            </tr>
        </table>
    </button>
    {% endfor %}
    {% if usuario %}
    <button class="campeonato-item add-button" id="add_campeonato_modal_button">
        <p style="margin: 4px;"><b>Criar novo campeonato.</b></p>
        <p style="margin: 4px;"><img src="/static/add.svg"/></p>
    </button>
    {% endif %}
</div>
{% endblock %}
{% block modals %}
<div class="modal" id="criar_campeonato_modal">
    <div class="modal-content">
        <table>
            <tr>
                <td><h3>Criar Novo Campeonato</h3></td>
                <td><button class="close-button" id="close_add_campeonato_modal_button"><b>&times;<b></button></td>
            </tr>
        </table>
        <form>
            <label for="nome">Nome Oficial:</label>
            <input type="text" id="nome" name="nome" maxlength="255" autofocus required>
            <label for="descricao">Descrição e Regras:</label>
            <textarea id="descricao" name="descricao" maxlength="500" style="height:70px;"></textarea>
            <label for="url_logo">Logo (URL):</label>
            <input type="url" id="url_logo" name="url_logo" maxlength="255">
            <label for="esporte">Esporte:</label>
            <select id="esporte" name="esporte">
                {% for esporte in esportes %}
                <option value="{{ esporte.nome }}">{{ esporte.nome }}</option>
                {% endfor %}
            </select>
            <label for="data_inicio">Data de Iníco:</label>
            <input type="date" id="data_inicio" name="data_inicio" required>
            <label for="data_fim">Data de Fim:</label>
            <input type="date" id="data_fim" name="data_fim" required>
        </form>
        <br><br>
        <button class="button" id="criar_campeonato_button">Proceder</button>
    </div>
</div>
{% endblock %}
{% block script %}
<script>
    // BOTÕES DE CAMPEONATOS
    {% for campeonato in campeonatos %}
    var button_{{ campeonato.id_campeonato }} = document.getElementById("{{ campeonato.id_campeonato }}");
    button_{{ campeonato.id_campeonato }}.onclick = function() {
        window.location.replace("/campeonato?id={{ campeonato.id_campeonato }}");
    }

    {% endfor %}
    {% if usuario %}
    // CAMPEONATO MODAL
    var modal_campeonato_criar = document.getElementById("criar_campeonato_modal");
    
    var button_add_campeonato_model = document.getElementById("add_campeonato_modal_button");
    button_add_campeonato_model.onclick = function() {
        modal_campeonato_criar.style.display = "block";
    }
    
    var button_campeonato_criar_model_close = document.getElementById("close_add_campeonato_modal_button");
    button_campeonato_criar_model_close.onclick = function() {
        modal_campeonato_criar.style.display = "none";
    }

    var button_criar_campeonato = document.getElementById("criar_campeonato_button");
    button_criar_campeonato.onclick = function() {
        var nome = document.querySelector('#criar_campeonato_modal input[name="nome"]').value;
        var descricao = document.querySelector('#criar_campeonato_modal textarea[name="descricao"]').value;
        var url_logo = document.querySelector('#criar_campeonato_modal input[name="url_logo"]').value;
        var esporte = document.querySelector('#criar_campeonato_modal select[name="esporte"]').value;
        var data_inicio = document.querySelector('#criar_campeonato_modal input[name="data_inicio"]').value;
        var data_fim = document.querySelector('#criar_campeonato_modal input[name="data_fim"]').value;

        var formData = new FormData();
        formData.append('nome', nome);
        formData.append('descricao', descricao);
        formData.append('url_logo', url_logo);
        formData.append('esporte', esporte);
        formData.append('data_inicio', data_inicio);
        formData.append('data_fim', data_fim);

        fetch('/campeonato_criar', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                location.reload();
            } else {
                alert(data.message);
            }
        })
        .catch(error => {
            alert('Erro de conexão: ' + error);
        });
    }
    {% endif %}
</script>
{% endblock %}